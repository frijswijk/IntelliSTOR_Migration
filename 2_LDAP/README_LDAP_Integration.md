# LDAP Integration Tool for IntelliSTOR Migration

Python-based LDAP integration tool to import users and groups from CSV files into Active Directory. Includes connection testing, CSV import with dry-run mode, and a standalone HTML browser for LDAP directory exploration.

## Overview

This tool facilitates the migration of IntelliSTOR users and groups to Active Directory (Microsoft LDAP). It reads the `UserGroups.csv` and `Users.csv` files generated by `Extract_Users_Permissions.py` and creates corresponding entries in Active Directory.

**Key Features:**
- Test LDAP connectivity before import
- Import groups and users from CSV files
- Dry-run mode to preview operations
- Multiple password strategies (default, random, skip)
- Standalone HTML browser for LDAP exploration
- Detailed logging and error handling
- Verification of imported entries

## Requirements

### Python Dependencies

```bash
pip install ldap3 flask flask-cors
```

Or install from requirements.txt:

```bash
pip install -r requirements.txt
```

### System Requirements

- Python 3.7 or higher
- Network access to Active Directory LDAP server
- Appropriate LDAP credentials with write permissions
- SSL/TLS connection for password operations (port 636)

## SSL Certificate Verification

When connecting to LDAP servers with SSL/TLS (port 636), the tool supports three certificate verification modes to handle both production certificates and self-signed certificates commonly used in development/testing environments.

### Overview of Verification Modes

#### 1. System Certificate Store (Default)

Uses the operating system's trusted certificate authorities to validate the server certificate. This is the most secure option and should be used in production with properly signed certificates.

**Usage:**
```bash
python ldap_integration.py test-connection \
  --server ldap.ocbc.com \
  --port 636 \
  --use-ssl \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com"
```

**When to use:**
- Production environments with valid SSL certificates
- Certificates signed by trusted CAs (DigiCert, Let's Encrypt, etc.)
- No additional flags needed - this is the default behavior

#### 2. Custom CA Certificate (Recommended for Self-Signed)

Validates the server certificate against a specific CA certificate file. This is the recommended approach for self-signed certificates as it maintains security while allowing connection to internal servers.

**Usage:**
```bash
python ldap_integration.py test-connection \
  --server YLDAPTEST-DC01.ldap1test.loc \
  --port 636 \
  --use-ssl \
  --ssl-ca-cert ca-cert.pem \
  --bind-dn "cn=administrator,cn=Users,dc=ldap1test,dc=loc" \
  --password "YourPassword" \
  --base-dn "dc=ldap1test,dc=loc"
```

**When to use:**
- Development/staging environments with self-signed certificates
- Internal LDAP servers with custom CA
- When you need secure verification but don't have publicly trusted certificates

**Certificate format:** PEM format (text file starting with `-----BEGIN CERTIFICATE-----`)

#### 3. Skip Verification (Testing Only - INSECURE)

Disables all SSL certificate verification. This allows connection to any server regardless of certificate validity but is vulnerable to man-in-the-middle attacks.

**Usage:**
```bash
python ldap_integration.py test-connection \
  --server YLDAPTEST-DC01.ldap1test.loc \
  --port 636 \
  --use-ssl \
  --ssl-no-verify \
  --bind-dn "cn=administrator,cn=Users,dc=ldap1test,dc=loc" \
  --password "YourPassword" \
  --base-dn "dc=ldap1test,dc=loc"
```

**When to use:**
- Quick connectivity testing only
- Troubleshooting SSL connection issues
- Never in production environments

**Security warning:** When using `--ssl-no-verify`, a prominent warning is displayed:
```
======================================================================
SECURITY WARNING: SSL certificate verification is disabled!
This is INSECURE and should only be used for testing.
Man-in-the-middle attacks are possible.
======================================================================
```

### Obtaining CA Certificate from LDAP Server

#### Windows (using OpenSSL)

Export the server's certificate to PEM format:

```bash
# Basic export
openssl s_client -connect YLDAPTEST-DC01.ldap1test.loc:636 -showcerts < nul 2>&1 | openssl x509 -outform PEM > ca-cert.pem

# Verify certificate was exported
openssl x509 -in ca-cert.pem -text -noout
```

#### Linux/macOS

```bash
# Export certificate
openssl s_client -connect ldap.example.com:636 -showcerts </dev/null 2>&1 | openssl x509 -outform PEM > ca-cert.pem

# Verify certificate
openssl x509 -in ca-cert.pem -text -noout
```

#### Windows Server (Export from Active Directory)

Using PowerShell to export from certificate store:

```powershell
# Find the certificate
Get-ChildItem -Path Cert:\LocalMachine\My | Where-Object {$_.Subject -like "*ldap*"}

# Export to file (replace thumbprint with your certificate)
$cert = Get-ChildItem -Path Cert:\LocalMachine\My\<THUMBPRINT>
$pemCert = @(
    '-----BEGIN CERTIFICATE-----'
    [System.Convert]::ToBase64String($cert.RawData, [System.Base64FormattingOptions]::InsertLineBreaks)
    '-----END CERTIFICATE-----'
)
$pemCert | Out-File -FilePath ca-cert.pem -Encoding ASCII
```

### Using CA Certificate Directory

For multiple CA certificates, you can use a directory containing certificate files:

```bash
# Create directory
mkdir ca-certs

# Add multiple certificates
openssl s_client -connect server1.example.com:636 -showcerts </dev/null 2>&1 | openssl x509 -outform PEM > ca-certs/server1.pem
openssl s_client -connect server2.example.com:636 -showcerts </dev/null 2>&1 | openssl x509 -outform PEM > ca-certs/server2.pem

# Use directory
python ldap_integration.py test-connection \
  --server server1.example.com \
  --port 636 \
  --use-ssl \
  --ssl-ca-path ca-certs \
  --bind-dn "cn=admin,dc=example,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=example,dc=com"
```

### Troubleshooting SSL Errors

#### Error: "SSL certificate verify failed"

**Cause:** Server certificate cannot be validated by system certificate store.

**Solutions:**
1. Use `--ssl-ca-cert` with exported certificate (recommended)
2. Use `--ssl-no-verify` for testing only
3. Install the CA certificate in system trust store

#### Error: "certificate verify failed: self signed certificate"

**Cause:** Server is using a self-signed certificate.

**Solution:** Export the certificate and use `--ssl-ca-cert`:
```bash
openssl s_client -connect server:636 -showcerts < nul 2>&1 | openssl x509 -outform PEM > ca-cert.pem
python ldap_integration.py test-connection ... --ssl-ca-cert ca-cert.pem
```

#### Error: "CA certificate file not found: ca-cert.pem"

**Cause:** The specified certificate file doesn't exist or path is incorrect.

**Solution:**
1. Verify file exists: `dir ca-cert.pem` (Windows) or `ls -l ca-cert.pem` (Linux)
2. Use absolute path: `--ssl-ca-cert C:\path\to\ca-cert.pem`
3. Ensure file is in current directory

#### Error: "Cannot use --ssl-no-verify with --ssl-ca-cert"

**Cause:** Conflicting SSL options specified.

**Solution:** Choose one verification method:
- Remove `--ssl-no-verify` to use certificate verification
- Remove `--ssl-ca-cert` to skip verification

#### Helpful Error Messages

When SSL certificate errors are detected, the tool provides suggestions:

```
ERROR - Connection failed: Cannot connect to server
ERROR - Error: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed

SSL certificate error detected. Try one of these options:
  1. Skip verification (testing only): --ssl-no-verify
  2. Use custom CA cert (recommended): --ssl-ca-cert path/to/ca-cert.pem
  3. Use system cert store (default): ensure server has valid certificate
```

### Certificate Verification by Environment

| Environment | Recommended Mode | Flags | Notes |
|-------------|-----------------|-------|-------|
| Production | System Store | `--use-ssl` | Use valid certificates from trusted CA |
| Staging | Custom CA | `--use-ssl --ssl-ca-cert ca-cert.pem` | Export and verify against staging CA |
| Development | Custom CA | `--use-ssl --ssl-ca-cert ca-cert.pem` | Maintain security with self-signed certs |
| Quick Test | Skip Verify | `--use-ssl --ssl-no-verify` | Only for initial connectivity testing |

### Security Best Practices

1. **Never use `--ssl-no-verify` in production** - This disables all certificate validation and exposes connections to man-in-the-middle attacks.

2. **Use `--ssl-ca-cert` for self-signed certificates** - This maintains security while working with internal certificates.

3. **Verify certificate fingerprints** - When exporting certificates, verify the fingerprint matches the expected value:
   ```bash
   openssl x509 -in ca-cert.pem -fingerprint -noout
   ```

4. **Protect certificate files** - CA certificate files should be read-only and protected from unauthorized modification.

5. **Regular certificate rotation** - Update certificates before expiration and re-export when certificates are renewed.

6. **Monitor certificate expiration** - Check certificate validity:
   ```bash
   openssl x509 -in ca-cert.pem -dates -noout
   ```

### Example Workflows

#### Workflow 1: Initial Testing with Self-Signed Certificate

```bash
# Step 1: Quick test with verification disabled
python ldap_integration.py test-connection \
  --server YLDAPTEST-DC01.ldap1test.loc \
  --port 636 \
  --use-ssl \
  --ssl-no-verify \
  --bind-dn "cn=administrator,cn=Users,dc=ldap1test,dc=loc" \
  --password "YourPassword" \
  --base-dn "dc=ldap1test,dc=loc"

# Step 2: Export certificate
openssl s_client -connect YLDAPTEST-DC01.ldap1test.loc:636 -showcerts < nul 2>&1 | openssl x509 -outform PEM > ca-cert.pem

# Step 3: Test with certificate verification
python ldap_integration.py test-connection \
  --server YLDAPTEST-DC01.ldap1test.loc \
  --port 636 \
  --use-ssl \
  --ssl-ca-cert ca-cert.pem \
  --bind-dn "cn=administrator,cn=Users,dc=ldap1test,dc=loc" \
  --password "YourPassword" \
  --base-dn "dc=ldap1test,dc=loc"
```

#### Workflow 2: Production Deployment with Valid Certificate

```bash
# No special flags needed - uses system certificate store
python ldap_integration.py add-all \
  --server ldaps.ocbc.com \
  --port 636 \
  --use-ssl \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --groups-ou "ou=Groups,dc=ocbc,dc=com" \
  --users-ou "ou=Users,dc=ocbc,dc=com" \
  --groups-csv UserGroups.csv \
  --users-csv Users.csv \
  --password-strategy random
```

### Active Directory Prerequisites

1. **Organizational Units (OUs) must exist:**
   - Groups OU (e.g., `ou=Groups,dc=ocbc,dc=com`)
   - Users OU (e.g., `ou=Users,dc=ocbc,dc=com`)

2. **Bind DN must have permissions to:**
   - Create groups in Groups OU
   - Create users in Users OU
   - Set passwords (requires SSL)

3. **Server Configuration:**
   - Port 389 for non-SSL operations
   - Port 636 for SSL operations (required for passwords)

## File Structure

```
Migration_Users/
├── ldap_integration.py          # Main integration script
├── ldap_browser.html            # Standalone HTML browser
├── README_LDAP_Integration.md   # This file
├── UserGroups.csv               # Input: Groups to import
├── Users.csv                    # Input: Users to import
└── logs/
    └── ldap_integration.log     # Execution logs
```

## Input File Formats

### UserGroups.csv

```csv
SECURITYDOMAIN_ID,GROUP_ID,FLAGS,GROUPNAME,DESCRIPTION
1,1,3,Domain Users,Default domain group
1,2,0,MD system,Medical department
```

**Required Columns:**
- `GROUP_ID`: Unique group identifier
- `GROUPNAME`: Group name (becomes CN and sAMAccountName)

**Optional Columns:**
- `DESCRIPTION`: Group description
- `FLAGS`: Group flags (not used in LDAP import)

### Users.csv

```csv
SECURITYDOMAIN_ID,USER_ID,USERNAME,PASSWORD,FLAGS,PASSWORD_LAST_MODIFIED_TIME,CREATION_TIME,LAST_MODIFIED_TIME,FULLNAME,DESCRIPTION
1,1,jdoe,<binary>,0,2009-08-07 17:54:22.870000,2009-08-07 17:54:22.870000,2009-08-07 17:54:22.870000,John Doe,Admin user
```

**Required Columns:**
- `USER_ID`: Unique user identifier
- `USERNAME`: Username (becomes CN and sAMAccountName)

**Optional Columns:**
- `FULLNAME`: Full name (becomes displayName)
- `DESCRIPTION`: User description
- `PASSWORD`: Binary password (see Password Strategy section)

## CSV to LDAP Mapping

### Groups

| CSV Column | LDAP Attribute | Notes |
|------------|----------------|-------|
| GROUPNAME | cn | Common name |
| GROUPNAME | sAMAccountName | Security account name |
| DESCRIPTION | description | Group description |
| (constant) | objectClass | [top, group] |
| (constant) | groupType | -2147483646 (global security) |

**Example DN:** `cn=Domain Users,ou=Groups,dc=ocbc,dc=com`

### Users

| CSV Column | LDAP Attribute | Notes |
|------------|----------------|-------|
| USERNAME | cn | Common name |
| USERNAME | sAMAccountName | Security account name |
| USERNAME@ocbc.com | userPrincipalName | Generated from username |
| FULLNAME | displayName | Display name |
| DESCRIPTION | description | User description |
| USER_ID | employeeID | For tracking |
| (constant) | objectClass | [top, person, organizationalPerson, user] |
| (constant) | userAccountControl | 512 (enabled account) |
| (strategy) | unicodePwd | Password (see strategies below) |

**Example DN:** `cn=jdoe,ou=Users,dc=ocbc,dc=com`

## Usage

### 1. Test Connection

Test LDAP connectivity before importing data:

```bash
python ldap_integration.py test-connection \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com"
```

**Output:**
```
INFO - Testing LDAP connection...
INFO - Connection successful
INFO - Server: Microsoft Active Directory
INFO - Version: 2019
INFO - Naming contexts: ['dc=ocbc,dc=com']
```

### 2. Import Groups (Dry-Run)

Preview group import without making changes:

```bash
python ldap_integration.py add-groups \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --groups-ou "ou=Groups,dc=ocbc,dc=com" \
  --csv UserGroups.csv \
  --dry-run
```

**Output:**
```
INFO - Processing 50 groups...
INFO - [DRY-RUN] Would create group: Domain Users
INFO - [DRY-RUN] Would create group: MD system
...
======================================================================
DRY-RUN COMPLETE
Total: 50
Created: 50
Skipped: 0
Errors: 0
======================================================================
```

### 3. Import Groups (Production)

Import groups into Active Directory:

```bash
python ldap_integration.py add-groups \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --groups-ou "ou=Groups,dc=ocbc,dc=com" \
  --csv UserGroups.csv
```

### 4. Import Users with Password Strategy

**Option A: Default Password for All Users (Recommended)**

Set a temporary password for all users:

```bash
python ldap_integration.py add-users \
  --server ldap.ocbc.com \
  --port 636 \
  --use-ssl \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --users-ou "ou=Users,dc=ocbc,dc=com" \
  --csv Users.csv \
  --password-strategy default \
  --default-password "TempP@ss123"
```

**Option B: Random Passwords**

Generate random passwords (exported to `random_passwords.csv`):

```bash
python ldap_integration.py add-users \
  --server ldap.ocbc.com \
  --port 636 \
  --use-ssl \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --users-ou "ou=Users,dc=ocbc,dc=com" \
  --csv Users.csv \
  --password-strategy random
```

**Option C: Skip Passwords**

Create users without passwords (set manually later):

```bash
python ldap_integration.py add-users \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --users-ou "ou=Users,dc=ocbc,dc=com" \
  --csv Users.csv \
  --password-strategy skip
```

### 5. Import All (Groups + Users)

Import both groups and users in one operation:

```bash
python ldap_integration.py add-all \
  --server ldap.ocbc.com \
  --port 636 \
  --use-ssl \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --groups-ou "ou=Groups,dc=ocbc,dc=com" \
  --users-ou "ou=Users,dc=ocbc,dc=com" \
  --groups-csv UserGroups.csv \
  --users-csv Users.csv \
  --password-strategy default \
  --default-password "TempP@ss123"
```

### 6. Search LDAP Directory

Search for entries using LDAP filters:

```bash
# Search all users
python ldap_integration.py search \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --filter "(objectClass=user)"

# Search specific user
python ldap_integration.py search \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --filter "(sAMAccountName=jdoe)" \
  --attributes "cn,sAMAccountName,mail,displayName"
```

### 7. Start LDAP Browser

Launch the HTML browser interface:

```bash
python ldap_integration.py serve-browser \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --api-host 127.0.0.1 \
  --api-port 5000
```

Then open `ldap_browser.html` in your web browser.

### 8. Verify Import

Verify that imported entries exist in Active Directory:

```bash
python ldap_integration.py verify-import \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --groups-csv UserGroups.csv \
  --users-csv Users.csv
```

## Password Strategies

### use-csv (Default)

Attempts to use the PASSWORD field from CSV. **Note:** The CSV password is a binary blob from the IntelliSTOR database and cannot be used directly in Active Directory.

**Result:** Passwords are skipped with a warning. Use `default` or `random` strategy instead.

### default

Sets the same password for all users. Requires `--default-password` parameter.

**Use Case:** Testing, temporary passwords

**Security:** Users should change password on first login

**Example:**
```bash
--password-strategy default --default-password "TempP@ss123"
```

### random

Generates a random 12-character password for each user. Passwords are exported to `random_passwords.csv`.

**Use Case:** Production deployment with secure passwords

**Example:**
```bash
--password-strategy random
```

**Output File (random_passwords.csv):**
```csv
username,password
jdoe,Xy8$kL2#mN9!
msmith,Pq3@wR7&zT4%
```

### skip

Creates users without setting passwords. Passwords must be set manually later.

**Use Case:** Manual password management

**Example:**
```bash
--password-strategy skip
```

## Password Requirements for Active Directory

### SSL/TLS Requirement

Password operations **REQUIRE** SSL/TLS connection:
- Use `--use-ssl` flag
- Use port `636` (LDAPS)
- Server must have valid SSL certificate

**Example:**
```bash
--port 636 --use-ssl
```

### Password Encoding

Active Directory requires passwords to be:
1. Enclosed in double quotes: `"MyPassword"`
2. Encoded as UTF-16LE
3. Sent over SSL connection

The tool handles encoding automatically.

### Password Complexity

Ensure passwords meet AD complexity requirements:
- At least 8 characters
- Contains uppercase, lowercase, numbers, and symbols
- Not based on username or common words

## LDAP Browser

The standalone HTML browser provides a web interface for exploring the LDAP directory.

### Features

- Connection status indicator
- Search users and groups
- Browse organizational units
- View entry details and attributes
- Real-time LDAP queries via Flask API

### Usage

1. Start the Flask API:
   ```bash
   python ldap_integration.py serve-browser \
     --server ldap.ocbc.com \
     --port 389 \
     --bind-dn "cn=admin,dc=ocbc,dc=com" \
     --password "YourPassword" \
     --base-dn "dc=ocbc,dc=com"
   ```

2. Open `ldap_browser.html` in a web browser

3. Use the search box to find users and groups

4. Click on entries to view details

### API Endpoints

The Flask API provides these endpoints:

- `GET /api/health` - Connection status
- `GET /api/tree?base_dn=<dn>` - Get OU tree structure
- `GET /api/search?q=<query>&type=<all|user|group>` - Search directory
- `GET /api/entry/<dn>` - Get entry details

## Error Handling

### Connection Errors

**Authentication Failed:**
```
ERROR - Connection failed: Authentication failed
ERROR - Error: invalid credentials
```

**Solution:** Verify bind DN and password

**Cannot Connect to Server:**
```
ERROR - Connection failed: Cannot connect to server
ERROR - Error: [Errno 11001] getaddrinfo failed
```

**Solution:** Check server address, port, and network connectivity

**SSL Errors:**
```
ERROR - Connection failed: SSL error
```

**Solution:** Verify SSL certificate, use correct port (636)

### Import Errors

**Entry Already Exists:**
```
WARNING - Group already exists: Domain Users
```

**Solution:** Entry is skipped automatically

**Invalid DN:**
```
ERROR - Failed to create group: invalid DN syntax
```

**Solution:** Verify OU DN format

**Permission Denied:**
```
ERROR - Failed to create user: insufficient access rights
```

**Solution:** Verify bind DN has write permissions

### Continue on Error

By default, the tool continues processing even if individual entries fail. Use `--continue-on-error` flag to control this behavior.

## Logging

### Log File

All operations are logged to `ldap_integration.log` in the output directory.

**Log Format:**
```
2026-01-23 10:30:45 - INFO - Testing LDAP connection...
2026-01-23 10:30:46 - INFO - Connection successful
2026-01-23 10:30:50 - INFO - Processing 50 groups...
2026-01-23 10:30:51 - INFO - Created group: Domain Users
```

### Console Output

- **INFO** level messages shown by default
- **DEBUG** level messages only in log file
- Use `--quiet` flag for minimal console output

### Quiet Mode

Minimal console output, suitable for scripting:

```bash
python ldap_integration.py add-groups \
  --server ldap.ocbc.com \
  --port 389 \
  --bind-dn "cn=admin,dc=ocbc,dc=com" \
  --password "YourPassword" \
  --base-dn "dc=ocbc,dc=com" \
  --groups-ou "ou=Groups,dc=ocbc,dc=com" \
  --csv UserGroups.csv \
  --quiet
```

## Best Practices

### 1. Test Connection First

Always test connectivity before importing:

```bash
python ldap_integration.py test-connection <args>
```

### 2. Use Dry-Run Mode

Preview operations before executing:

```bash
python ldap_integration.py add-groups <args> --dry-run
```

### 3. Start with Small Batch

Test with a subset of data:

1. Create test CSV files with 2-3 entries
2. Import to test environment
3. Verify results
4. Proceed with full import

### 4. Use SSL for Passwords

Always use SSL when setting passwords:

```bash
--port 636 --use-ssl
```

### 5. Verify After Import

Check that all entries were created:

```bash
python ldap_integration.py verify-import <args>
```

### 6. Backup Before Import

Create AD backup before importing production data.

### 7. Use Random Passwords for Production

Generate secure random passwords:

```bash
--password-strategy random
```

## Troubleshooting

### Issue: "Groups OU does not exist"

**Solution:** Create the OU in Active Directory first:

```powershell
# PowerShell
New-ADOrganizationalUnit -Name "Groups" -Path "dc=ocbc,dc=com"
```

### Issue: "Password operations require SSL"

**Solution:** Use SSL connection:

```bash
--port 636 --use-ssl
```

### Issue: "CSV password is binary blob, skipping password"

**Solution:** Use `default` or `random` password strategy:

```bash
--password-strategy default --default-password "TempP@ss123"
```

### Issue: "Invalid characters in sAMAccountName"

**Solution:** Clean username data in CSV before import. Remove invalid characters: `" / \ [ ] : ; | = , + * ? < >`

### Issue: "Browser shows 'Connection Failed'"

**Solution:**
1. Verify Flask API is running
2. Check API host/port in browser HTML (default: 127.0.0.1:5000)
3. Open browser console for error details

## Advanced Usage

### Custom Output Directory

Specify custom directory for logs:

```bash
python ldap_integration.py add-groups <args> --output-dir C:\Logs
```

### Batch Processing Script

Create a batch script for automated import:

```powershell
# import_all.ps1
$server = "ldap.ocbc.com"
$port = "636"
$bindDn = "cn=admin,dc=ocbc,dc=com"
$password = "YourPassword"
$baseDn = "dc=ocbc,dc=com"
$groupsOu = "ou=Groups,dc=ocbc,dc=com"
$usersOu = "ou=Users,dc=ocbc,dc=com"

# Test connection
python ldap_integration.py test-connection `
  --server $server `
  --port 389 `
  --bind-dn $bindDn `
  --password $password `
  --base-dn $baseDn

if ($LASTEXITCODE -ne 0) {
    Write-Error "Connection test failed"
    exit 1
}

# Import groups
python ldap_integration.py add-groups `
  --server $server `
  --port 389 `
  --bind-dn $bindDn `
  --password $password `
  --base-dn $baseDn `
  --groups-ou $groupsOu `
  --csv UserGroups.csv

# Import users
python ldap_integration.py add-users `
  --server $server `
  --port $port `
  --use-ssl `
  --bind-dn $bindDn `
  --password $password `
  --base-dn $baseDn `
  --users-ou $usersOu `
  --csv Users.csv `
  --password-strategy random

# Verify
python ldap_integration.py verify-import `
  --server $server `
  --port 389 `
  --bind-dn $bindDn `
  --password $password `
  --base-dn $baseDn `
  --groups-csv UserGroups.csv `
  --users-csv Users.csv
```

## Security Considerations

### 1. Protect Credentials

- Never commit passwords to version control
- Use environment variables or secure credential stores
- Restrict access to CSV files containing user data

### 2. Use SSL for Password Operations

- Always use SSL (port 636) when setting passwords
- Verify server SSL certificates

### 3. Secure Random Passwords

- Use `random` strategy for production
- Store generated passwords securely
- Implement password change on first login

### 4. Audit and Logging

- Review logs after import
- Monitor Active Directory audit logs
- Verify group memberships and permissions

### 5. Test Environment

- Test import in non-production environment first
- Verify all operations before production deployment

## Support and Troubleshooting

### Log Analysis

Check log file for detailed error messages:

```bash
tail -f ldap_integration.log
```

### Enable Debug Logging

Debug logging is automatically enabled in log file (DEBUG level).

### Common Exit Codes

- `0` - Success
- `1` - Error (connection failed, import errors, etc.)

## License and Author

**Author:** Generated for OCBC IntelliSTOR Migration
**Date:** 2026-01-23
**Purpose:** Migrate IntelliSTOR users and groups to Active Directory

## Appendix

### A. Active Directory Attribute Reference

**Group Attributes:**
- `objectClass`: [top, group]
- `cn`: Common name
- `sAMAccountName`: Pre-Windows 2000 name
- `description`: Description
- `groupType`: -2147483646 (global security group)

**User Attributes:**
- `objectClass`: [top, person, organizationalPerson, user]
- `cn`: Common name
- `sAMAccountName`: Pre-Windows 2000 logon name
- `userPrincipalName`: User principal name (UPN)
- `displayName`: Display name
- `description`: Description
- `employeeID`: Employee ID
- `userAccountControl`: 512 (normal enabled account)
- `unicodePwd`: Password (UTF-16LE encoded)

### B. LDAP Filter Examples

**All users:**
```
(objectClass=user)
```

**All groups:**
```
(objectClass=group)
```

**User by username:**
```
(sAMAccountName=jdoe)
```

**Users starting with 'j':**
```
(&(objectClass=user)(cn=j*))
```

**Groups containing 'admin':**
```
(&(objectClass=group)(cn=*admin*))
```

### C. Requirements.txt

```txt
ldap3>=2.9.1
flask>=2.3.0
flask-cors>=4.0.0
```

## Quick Reference

### Common Commands

```bash
# Test connection
python ldap_integration.py test-connection --server <server> --port 389 --bind-dn <dn> --password <pwd> --base-dn <dn>

# Import groups (dry-run)
python ldap_integration.py add-groups --server <server> --port 389 --bind-dn <dn> --password <pwd> --base-dn <dn> --groups-ou <ou> --csv UserGroups.csv --dry-run

# Import users with default password
python ldap_integration.py add-users --server <server> --port 636 --use-ssl --bind-dn <dn> --password <pwd> --base-dn <dn> --users-ou <ou> --csv Users.csv --password-strategy default --default-password <pwd>

# Import all
python ldap_integration.py add-all --server <server> --port 636 --use-ssl --bind-dn <dn> --password <pwd> --base-dn <dn> --groups-ou <ou> --users-ou <ou> --groups-csv UserGroups.csv --users-csv Users.csv --password-strategy default --default-password <pwd>

# Start browser
python ldap_integration.py serve-browser --server <server> --port 389 --bind-dn <dn> --password <pwd> --base-dn <dn>

# Verify import
python ldap_integration.py verify-import --server <server> --port 389 --bind-dn <dn> --password <pwd> --base-dn <dn> --groups-csv UserGroups.csv --users-csv Users.csv
```

### Parameters Quick Reference

| Parameter | Description | Required | Default |
|-----------|-------------|----------|---------|
| --server | LDAP server hostname/IP | Yes | - |
| --port | LDAP port | No | 389 |
| --bind-dn | Bind DN for authentication | Yes | - |
| --password | Bind password | Yes | - |
| --use-ssl | Use SSL/TLS | No | False |
| --base-dn | Base DN | Yes | - |
| --groups-ou | Groups OU DN | Varies | - |
| --users-ou | Users OU DN | Varies | - |
| --csv | CSV file path | Varies | - |
| --groups-csv | Groups CSV file | Varies | - |
| --users-csv | Users CSV file | Varies | - |
| --password-strategy | Password strategy | No | use-csv |
| --default-password | Default password | Varies | - |
| --dry-run | Preview mode | No | False |
| --quiet | Quiet mode | No | False |
| --output-dir | Output directory | No | . |
